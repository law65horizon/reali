# Updated property.graphql

enum ListingStatus {
  DRAFT
  PUBLISHED
  PENDING_REVIEW
  ARCHIVED
}

enum PropertyType {
  APARTMENT
  HOUSE
  HOTEL
}

type PropertyReview {
    id: ID!
    property_id: ID!
    user_id: ID!
    user: User!
    rating: Int!
    comment: String
    created_at: DateTime!
}

type Address {
  id: ID!
  street: String!
  city: String!
  postal_code: String
  country: String!
  latitude: Float
  longitude: Float
}

type Image {
  id: ID!
  # property_id: ID!
  url: String!
  meta_data: String
  caption: String
}

type User {
  id: ID!
  name: String!
  uid: String!
  email: String!
  phone: String
  description: String
  created_at: String!
  address_id: ID
  address: Address
}

type Property {
  id: ID!
  realtor: User!
  realtor_id: ID!
  address_id: ID!
  title: String
  speciality: String
  property_type: String!
  sale_status: String!
  description: String
  address: Address
  amenities: [String]
  roomTypes: [RoomType!]!
  images: [Image!]
  bookings: [PropertyBooking!]!
  reviews: [PropertyReview!]!
  created_at: DateTime!
  updated_at: DateTime!
}

type RoomType {
  id: ID!
  property_id: ID!
  name: String!
  description: String
  capacity: Int
  bedCount: Int
  bathroomCount: Int
  sizeSqft: Int
  basePrice: Float
  weeklyRate: Float
  monthlyRate: Float
  currency: String
  isActive: Boolean
  amenities: [String]
  units: [RoomUnit!]
  pricing: [RateCalendarEntry!]
  images: [Image!]
  property: Property
  availableUnits: Int
  totalUnits: Int
  created_at: DateTime!
  updated_at: DateTime!
}

type RateCalendarEntry {
  date: Date!
  nightly_rate: Float!
  min_stay: Int
  is_blocked: Boolean
}

input RateCalendarEntryInput {
  date: Date!
  nightlyRate: Float!
  minStay: Int
  isBlocked: Boolean
}

type RoomUnit {
  id: ID!
  room_type_id: ID!
  unit_code: String
  floor_number: Int
  status: String
}

type PropertyBooking {
  id: ID!
  unit: RoomUnit!
  guest: User!
  checkIn: Date!
  checkOut: Date!
  totalPrice: Float!
  currency: String
  status: String!
  source: String
  createdAt: String
}

type PageInfo {
    hasNextPage: Boolean!
    endCursor: String
}

type PropertyWithRealtor {
    id: ID!
    address: Address
    realtor_id: ID!
    price: Float
    description: String
    realtor: User!
}

input PropertyInput {
    realtor_id: ID!
    address: AddressInput!
    title: String
    speciality: String
    amenities: [String!]!
    price: Float
    image_urls: [String!]!
    description: String
    status: ListingStatus
    roomTypes: [RoomTypeInput!]
    property_type: String!
    sale_status: String!
}

input RoomUnitInput {
  roomTypeId: ID!
  unitCode: String
  floorNumber: Int
  status: String
}

input RoomTypeInput {
  name: String!
  description: String
  capacity: Int
  bedCount: Int
  bathroomCount: Int
  sizeSqft: Int
  basePrice: Float
  currency: String
  isActive: Boolean
  amenities: [String]
  pricingRules: [CreatePricingRuleInput!]
  durationDiscounts: [CreateDurationDiscountInput!]
}

input CreateDurationDiscountInput {
  stayType: String! # weekly | monthly
  discountPercent: Float!
}

input CreatePricingRuleInput {
  startDate: Date!
  endDate: Date!
  nightlyRate: Float
  minStay: Int
  maxStay: Int
  note: String
}

input AddressInput {
    street: String!
    city: String!
    postal_code: String
    country: String!
    longitude: Float
    latitude: Float
}

input PropertySearchInput {
    query: String
    minPrice: Float
    maxPrice: Float
    speciality: String
    amenities: [String!]
    startDate: Date
    endDate: Date
    minRating: Float
}

type PropertyEdge {
  node: Property!
  cursor: String!
}

type PropertyConnection {
  edges: [PropertyEdge!]!
  pageInfo: PageInfo!
  totalCount: Int!
}

type RoomTypeEdge {
  node: RoomType!
  cursor: String!
}

type RoomTypeConnection {
  edges: [RoomTypeEdge!]!
  pageInfo: PageInfo!
  totalCount: Int!
}

type CloudinarySignature {
  signature: String!
  timestamp: String!
  cloudName: String!
  apiKey: String!
}

input SearchRoomsInput {
  propertyType: String
  beds: Int
  bathrooms: Int
  minPrice: Float
  maxPrice: Float
  minSize: Float
  maxSize: Float
  amenities: [String!]
  query: String
  checkIn: Date
  checkOut: Date
  first: Int = 20
  after: String
  latitude: Float
  longitude: Float
  radius: Int
}

type Query {
  searchRoomTypes(input: SearchRoomsInput): RoomTypeConnection!

  getProperty(id: ID!): Property

  getListings(realtor_id: ID!): [Property!]!

  getRoomType(id: ID!): RoomType
  # Get calendar pricing and availability for a room type
  getAvailability(id: ID!, startDate: Date!, endDate: Date!): [RateCalendarEntry!]!

  # Get available units in a room type
  getAvailableUnits(id: ID!, checkIn: Date, checkOut: Date): [RoomUnit!]!
}

type Mutation {
  createProperty(input: PropertyInput!): Property!
  addRoomUnit(input: RoomUnitInput!): RoomUnit!
  updateProperty(id: ID!, input: PropertyInput!): Property!
  updateRoomUnit(input: RoomUnitInput!): RoomUnit!
  publishProperty(id: ID!): Property!
  archiveProperty(id: ID!): Property!
  deleteProperty(id: ID!): Boolean!
  generateCloudinarySignature: CloudinarySignature!
}

# Scalar Types
scalar Date
scalar DateTime
